{% load crispy_forms_tags %}
<div class="card col match-card">
  <form method="POST">
    <fieldset {% if currentleague.isFinished is True %} disabled {% endif %}>
      {% csrf_token %} {{ matchformset.management_form }}
      <table class="matchtable">
        <div class="row">
          <h3>
            Matches for 
            {% if currentleague.myFlavor.name != "none/stock" %}
              {{ currentleague.myFlavor }}
            {% endif %}
            {{ currentleague.myDeck }} league 
          </h3>
          <p>
            {{ currentleague.dateCreated }}
          </p>
        </div>
        <div class="line"></div>
        {% for form in matchformset %} {% if forloop.first %}
        <thead>
          <tr>
            <th>#</th>
            {% for field in form.visible_fields %}
            <th class="">
              {% if field.name == "game1" %}
              <span title="These are games 1, 2, and 3. Tick the box if you won that game">1</span>
              {% elif field.name == "game2" %}
              <span title="These are games 1, 2, and 3. Tick the box if you won that game">2</span>
              {% elif field.name == "game3" %}
              <span title="These are games 1, 2, and 3. Tick the box if you won that game">3</span>
              {% else %}
                {{ field.label }}
              {% endif %}
            </th>
            {% endfor %}
          </tr>
        </thead>
        {% endif %}
        <tbody>
          <tr>
            <td>{{ forloop.counter }}
              {% for hidden in form.hidden_fields %}
                {{ hidden }}
              {% endfor %}
            </td>
            {% for field in form.visible_fields %}
            <td>
              {% if field.name == "dateCreated" %}
                <button type='button'>date</button>
                {{ field.errors.as_ul }}
                {{ field }}
              {% elif field.name == "theirArchetype" %} 
                <button type='button'>Archetype</button>
                {{ field.errors.as_ul }}
                {{ field }}
              {% elif field.name == "theirname" %}
                {{ field.errors.as_ul }}
                {{ field }}
                <datalist id="usernamelist">
                  {% for match in usernamelist %}
                    <option value="{{match.theirname}}"></option>
                  {% endfor %}
                </datalist>
              {% else %}
                {{ field.errors.as_ul }} 
                {{ field }} 
              {% endif %}
              {{field.help_text}}
            </td>
            {% endfor %}
          </tr>
        </tbody>
        {% endfor %}
      </table>
      <div class="">
        <div class="">
          <button type="submit" class="ctn" name="matchformset">Save</button>
          <button type="button" class="ctn" name="drop" onclick="openDropPop()">Drop</button>
          <button type="button" class="ctn" name="delete" onclick="openDeletePop()">Delete</button>
        </div>
        <div class="popup" id="droppopup">
          <h2>Are you sure you want to drop?</h2>
          <div class="line"></div>
          <p style="text-align: left;">Dropping will close the league, the remaining matches will count as loses for scoring this league, but they won't otherwise affect your match win rate.</p>
          <button type="submit" name="drop" value="1">Drop</button>
        </div>
        <div class="popup" id="deletepopup">
          <h2>Are you sure you want to delete this league?</h2>
          <div class="line"></div>
          <p style="text-align: left;">The league and all of its matches will be deleted from the database.</p>
          <button type="submit" name="delete" value="1">Delete</button>
        </div>
      </div>
    </fieldset>
  </form>
</div>